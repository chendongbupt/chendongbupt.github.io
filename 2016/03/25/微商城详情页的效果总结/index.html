<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 微商城详情页的效果总结 · CDBlog</title><meta name="description" content="微商城详情页的效果总结 - chendong"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="CDBlog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">微商城详情页的效果总结</h1><div class="post-info">Mar 25, 2016</div><div class="post-content"><h3 id="微商城详情页H5效果"><a href="#微商城详情页H5效果" class="headerlink" title="微商城详情页H5效果"></a>微商城详情页H5效果</h3><p>这个效果是仿寺库APP的效果。<br><img src="/images/goodsAnim.gif" alt=""></p>
<h4 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h4><h5 id="商品图"><a href="#商品图" class="headerlink" title="商品图"></a>商品图</h5><p>这个比较好说，向上滑动到一定阶段触发动画， 商品图变小，采用的是CSS3的<code>translateZ()</code> <code>perspective</code> 实现，当然也可以通过<code>scale()</code>和设置外层div宽高实现，用<code>perspective</code>是为了顺便实现加入购物车按钮3D翻转的效果。<br>颜色变灰，则是 <code>filter:grayscale()</code>，最后消失则是 <code>opacity</code>，最后的这个消失效果是个兼容iOS下图片闪烁的处理，后面再谈这个兼容问题。</p>
<p>商品图是用了swipe.js滑动。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;goods-img&quot; id=&quot;slider&quot; style=&quot;visibility: visible; opacity: 1;&quot;&gt;</span><br><span class="line">            &lt;ul style=&quot;width: 1032.56px;&quot;&gt;</span><br><span class="line">                 &lt;li&gt;&lt;img src=&quot;&quot; alt=&quot;&quot;&gt;&lt;/li&gt;</span><br><span class="line">                 &lt;li&gt;&lt;img src=&quot;&quot; alt=&quot;&quot;&gt;&lt;/li&gt;</span><br><span class="line">                 &lt;li&gt;&lt;img src=&quot;&quot; alt=&quot;&quot;&gt;&lt;/li&gt;</span><br><span class="line">            &lt;/ul&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure></p>
<h5 id="详情介绍部分"><a href="#详情介绍部分" class="headerlink" title="详情介绍部分"></a>详情介绍部分</h5><p>一直居于底部，高度发生变化，并且是可滚动查看内容的。动画效果，主要是改变容器的<code>height</code>，并且绝对定位，居于底部，<code>position:absolute;</code>, 为了滚动， 加了属性 <code>overflow:scroll</code>。 一开始通过JS算出总高度和商品图高度，得到详情部分的初始高度。<code>touchstart</code>记录初始位置， <code>touchmove</code>则记录即时位置，<br>计算出商品图变小的比例和详情部分高度的变化。 <code>touchend</code>和 <strong><code>touchcancel</code></strong>的时候，位移小则回复原位，大于50则向上展开。<br>购物车的图标的动画效果，在iOS下会使<strong>商品图-详情部分-购物车图标</strong>三者层级混乱闪烁，<code>-webkit-backface-visibility:hidden</code>无效，商品图隐藏可以规避这个问题。<br><a id="more"></a><br>初始布局， 高度是JS计算出来添加的， overflow:hidden 处理。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#main .goods-info &#123;</span><br><span class="line">    overflow: hidden;</span><br><span class="line">    position: absolute;</span><br><span class="line">    margin: 0 0.27778rem;</span><br><span class="line">    width: 9.44444rem;</span><br><span class="line">    left: 0;</span><br><span class="line">    z-index: 2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;div class=&quot;goods-info&quot; style=&quot;overflow: hidden; transform: translateY(-10px); height: 313px;&quot;&gt;        </span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure></p>
<p>动画后, translateY向上移位， 高度变化， 并增加 overlfow:scroll， 让内容能滚动。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">css:</span><br><span class="line">overflow: scroll;</span><br><span class="line">transform: translateY(-289px);</span><br><span class="line">height: 592px;</span><br></pre></td></tr></table></figure></p>
<h4 id="JS"><a href="#JS" class="headerlink" title="JS"></a>JS</h4><p>JS的坑。。<br>1 Android下， <code>touchmove</code> 事件只触发一次，不能实时触发，导致不能计算高度变化和图片缩小， 然后采用了 <code>event.preventDefault()</code> 解决；<br>2 <code>preventDefault</code>阻止了默认，导致按钮和<code>&lt;a href&gt;</code>无效。 打补丁，添加<code>event.target</code>判断；<br>3 与click事件的分辨，<code>click</code>过程是touchstart-&gt;touchend-&gt;click的触发顺序， 触发<code>touchmove</code>，则标记不是click事件;<br>4 touchcancel， 一开始的console没显示出触发<code>touchcancel</code>， 就忽略了~~  结果后面发现bug，<code>touchend</code>事件的尾处理失效，导致动画失效，<code>touchcancel</code> 加上尾处理解决；</p>
<p>代码如下： </p>
<ul>
<li>touchmove的兼容，用<code>e.preventDefault();</code>来处理</li>
<li><code>if (e.target.className.split(&quot; &quot;).indexOf(&quot;selt&quot;) &gt;= 0)  isPrevent = false;</code> 这段默认链接补丁，用了变量保存， 需要在DOM中添加class .selt </li>
<li>isTouchMove处理坑3</li>
<li><code>isPrevent = true; isTouchMove = false;</code> 加上尾 </li>
<li>direction 是一个保存方向的变量，用户使详情部分能够下滑还原</li>
<li>_animate 是滑动的动画处理</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">goodsinfo.on(&apos;touchstart&apos;, function(e)&#123;</span><br><span class="line">    touchsY = e.touches[0].pageY;</span><br><span class="line">    if (e.target.className.split(&quot; &quot;).indexOf(&quot;selt&quot;) &gt;= 0) </span><br><span class="line">        isPrevent = false;</span><br><span class="line">    if ( !direction &amp;&amp; isPrevent)&#123;</span><br><span class="line">        e.preventDefault();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">goodsinfo.on(&apos;touchmove&apos;, function(e)&#123;</span><br><span class="line">    isTouchMove = true;</span><br><span class="line">    touchmY = e.touches[0].pageY;</span><br><span class="line">    moveY = touchmY - touchsY;</span><br><span class="line">    if ( direction === false &amp;&amp; moveY &lt; 0 )  //向上滑动</span><br><span class="line">        move(moveY);</span><br><span class="line">    if ( direction === true &amp;&amp; goodsinfo.scrollTop() &lt;= 0 &amp;&amp; moveY &gt; 2 )&#123;</span><br><span class="line">        direction = false;</span><br><span class="line">        _animate(0);</span><br><span class="line">    &#125;</span><br><span class="line">    if ( !direction &amp;&amp; isPrevent)&#123;</span><br><span class="line">        e.preventDefault();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">goodsinfo.on(&apos;touchend&apos;, function(e)&#123;</span><br><span class="line">    if (  isPrevent )&#123;</span><br><span class="line">        if ( direction === true || isTouchMove === false )  //向下  不处理</span><br><span class="line">            return false;</span><br><span class="line">        toucheY = touchmY;</span><br><span class="line">        var moveUp = touchsY - toucheY;</span><br><span class="line">        if ( moveUp &gt; 20 &amp;&amp; direction === false )&#123;</span><br><span class="line">            direction = true;</span><br><span class="line">            _animate(imgHeight-windowWidth/5);</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            direction = false;</span><br><span class="line">            _animate(0);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    isPrevent = true;</span><br><span class="line">    isTouchMove = false;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">goodsinfo.on(&apos;touchcancel&apos;, function(e)&#123;   //touchcancel ，有时候touchend 不触发, 初始化 isPrevent isTouchMove</span><br><span class="line">    isPrevent = true;</span><br><span class="line">    isTouchMove = false;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div></article></div></main><footer><div class="paginator"><a href="/2016/03/27/fixed与input处理/" class="prev">上一篇</a><a href="/2016/03/23/oauth-url-filter/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2018 <a href="http://yoursite.com">chendong</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>