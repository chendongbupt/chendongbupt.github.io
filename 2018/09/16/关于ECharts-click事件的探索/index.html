<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 关于ECharts_click事件的探索 · CDBlog</title><meta name="description" content="关于ECharts_click事件的探索 - chendong"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="CDBlog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">关于ECharts_click事件的探索</h1><div class="post-info">Sep 16, 2018</div><div class="post-content"><h4 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h4><p>用echarts展示图表的时候，有时候需要点击当前图表，进行一些其他”effect side”操作,这个时候就需要得到当前这个点的横纵坐标的数据信息了。</p>
<hr>
<h4 id="探索方法"><a href="#探索方法" class="headerlink" title="探索方法"></a>探索方法</h4><h4 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h4><p>查看官网API文档 <a href="http://www.echartsjs.com/api.html#echarts" target="_blank" rel="noopener">http://www.echartsjs.com/api.html#echarts</a>, 支持鼠标click事件，拿到基础的 line bar 图例上试验。<br>发现click触发条件是：</p>
<ol>
<li>line图需要点击到数据气泡点上，需要精准点击，数据多的时候，精准点击是困难的</li>
<li>bar图需要点击到柱状上，如果某几个数据bar很小，也存在精准点击困难的问题</li>
</ol>
<h4 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h4><p>官网给出的API方法不尽如人意，去github上查找issue，发现有不少提出这问题。<br>解决方法：给出一个透明的bar坐标系重叠到图表上，透明bar的数据都是当前最大值，这样在图表对应的x轴都能实现触发点击，类似于tooltip那样方便。<br><a href="https://github.com/apache/incubator-echarts/issues/6106" target="_blank" rel="noopener">https://github.com/apache/incubator-echarts/issues/6106</a></p>
<p>但是，这个方法也有缺点：<br><a id="more"></a></p>
<ol>
<li>多了一个坐标系，增加了页面的数据量，加大了浏览器绘制压力</li>
<li>数据量大的时候，每个bar区域很小，bar之间存在空隙，准确点击也不那么容易</li>
</ol>
<p>所以，这个方法体验也不是那么好</p>
<h4 id="方法三"><a href="#方法三" class="headerlink" title="方法三"></a>方法三</h4><p>在试验方法二的时候，虽然准确点击体验不那么好，但hover触发的tooltip仍然十分流畅，但查看文档，tooltip虽然可以得到当前坐标的data数据，但无法判断事件。<br>所以想要tooltip那种点击得到当前数据的体验，需要结合一个click事件。</p>
<p>在官网示例上，找到一个click的示例， <a href="http://echarts.baidu.com/examples/editor.html?c=line-pen" target="_blank" rel="noopener">http://echarts.baidu.com/examples/editor.html?c=line-pen</a></p>
<p>zr的click在点击整个chart区域的时候都会触发，但往往需要排除掉图表区域外的无关区域，所以需要<code>convertFromPixel</code>转化到当前的坐标系，<code>containPixel</code>判断是否在当前坐标系中。<br>坐标点的数据呢？ 在tooltip的formatter中维护。 逻辑示例如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">var clickParams = null;</span><br><span class="line">myChart.options.tooltip.formatter = function(params)&#123;</span><br><span class="line">    clickParams = params;</span><br><span class="line">    // return formaater string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var zr = myChart.getZr();</span><br><span class="line">zr.on(&apos;click&apos;, function (params) &#123;</span><br><span class="line">    var pointInPixel = [params.offsetX, params.offsetY];   //得到点击事件的触发点</span><br><span class="line">    var pointInGrid = myChart.convertFromPixel(&apos;grid&apos;, pointInPixel);</span><br><span class="line"></span><br><span class="line">    if (myChart.containPixel(&apos;grid&apos;, pointInPixel)) &#123;  //判断是否在坐标系中</span><br><span class="line">        // 得到clickParams， effect side 处理</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>issue讨论：<a href="https://github.com/apache/incubator-echarts/issues/3853" target="_blank" rel="noopener">https://github.com/apache/incubator-echarts/issues/3853</a> </p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/08/26/webpack分模块加载失败的问题/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2018 <a href="http://yoursite.com">chendong</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>