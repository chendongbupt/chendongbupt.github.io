<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> BizCharts调研 · CDBlog</title><meta name="description" content="BizCharts调研 - chendong"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="CDBlog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">BizCharts调研</h1><div class="post-info">Nov 29, 2018</div><div class="post-content"><h4 id="BizCharts"><a href="#BizCharts" class="headerlink" title="BizCharts"></a>BizCharts</h4><p>官网：<a href="https://bizcharts.net/" target="_blank" rel="noopener">https://bizcharts.net/</a></p>
<p>简单说下特性:</p>
<ul>
<li>基于 G2 封装的 React 图表库，具有 G2、React 的全部优点，可以让用户以组件的形式组合出无数种图表</li>
<li>集成了大量的统计工具，支持多种坐标系绘制，交互定制，动画定制以及图形定制等</li>
<li>性能稳定且具有强大的扩展能力和高度自定义能力</li>
</ul>
<hr>
<a id="more"></a>
<h4 id="和ECharts对比"><a href="#和ECharts对比" class="headerlink" title="和ECharts对比"></a>和ECharts对比</h4><ul>
<li>ECharts是一个基本库，不依赖其他框架，在React/Vue/Angular中都可以使用。 BizCharts是基于G2的封装，组件的解析依赖于React。</li>
<li>ECharts是配置型，绝大部分展示交互通过配置options完成; BizCharts是编码型，提供了图表构成的各部分组件，引入组件来绘制图表</li>
<li>ECharts由百度开源，从2013.6至今，版本从1.0到4.2，包含了24种平面图和10种基于webGL的3D图，实现了多渲染方案(canvas,svg,vml)、跨平台使用，各种功能十分丰富； Bizcharts由ali开源，从2017.12月直接发布3.0版本，至今版本3.2，包含了14种图例，支持canvas,svg渲染方案，仅针对PC端，平台端分离出BizGoblin，功能配置项较ECharts少。</li>
<li>BizCharts部分功能不完备，例如resize，需要主动由window dispatch resize, 多Y轴需要用Dataset展开，排序没有默认转为数值，需要手动将字符串转为数值。</li>
<li>性能上，数据量不大的情况下，两者都可以接受。但ECharts有重构底层图形库ZRender,针对移动端优化，所以性能上更好。在图表中自定义一部分dom结构，同样的逻辑，ECharts流畅性能高。</li>
</ul>
<h4 id="体验改进"><a href="#体验改进" class="headerlink" title="体验改进"></a>体验改进</h4><p>G2 会将打点监控，默认会将 URL 等信息发送回 AntV 服务器。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">url: https://kcart.alipay.com/web/bi.do</span><br><span class="line">param:&#123; </span><br><span class="line">    BIProfile:merge, </span><br><span class="line">    d:[&#123;&quot;bizcharts&quot;:&quot;3.2.5-beta.3&quot;,&quot;pg&quot;:&quot;http://localhost:3000/#/app/2495489/performance/web&quot;,&quot;r&quot;:1541569473246,&quot;g2&quot;:true,&quot;version&quot;:&quot;3.3.3&quot;,&quot;page_type&quot;:&quot;syslog&quot;</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;</span><br><span class="line">设置track(false)可以关闭。</span><br><span class="line"></span><br><span class="line">BizCharts.track(false);// orimport &#123; track &#125; from &apos;bizcharts&apos;;track(false)常用组件</span><br></pre></td></tr></table></figure></p>
<hr>
<h4 id="Chart"><a href="#Chart" class="headerlink" title="Chart"></a>Chart</h4><p>图表最顶级的组件，控制着图表的创建、绘制、销毁等。</p>
<ul>
<li>renderer 图表渲染方式，默认为canvas，可设置为svg</li>
<li>data 图表数据源，JSON对象数组或者DataSet.View对象</li>
<li>scale 配置图表比例尺, 例如将Y轴设置为从0开始</li>
<li>padding 默认为’auto’, 比如设置左侧和下面的padding, padding={[‘auto’, ‘auto’, 20, 20]}</li>
<li>事件支持 <code>onPlotClick</code> 点击， <code>onTooltipChange</code> tooltip变化， <code>onPlotEnter</code>鼠标进入绘图区域等</li>
</ul>
<h4 id="Axis"><a href="#Axis" class="headerlink" title="Axis"></a>Axis</h4><p>坐标轴组件，控制图表中坐标轴的样式等。</p>
<ul>
<li>name 坐标轴对应数据源的字段key</li>
<li>label Object对象，{textStyle:{}, formatter(text,item,index){} …}，可设置坐标轴格式及样式等</li>
</ul>
<h4 id="Geom"><a href="#Geom" class="headerlink" title="Geom"></a>Geom</h4><p>几何标记对象，决定创建图表的类型。</p>
<ul>
<li>type 几何标记类型，有line(线图) interval(柱状图、饼图) area(区域图) edge(树图、关系图等)等</li>
<li>color 将数据值映射到图形的颜色, 可以是数据字段key,配合Legend组件显示，也可以是[field,[color1,color2]]的颜色映射</li>
<li>position 位置属性的映射，格式为 “a*b”，a字段对应横轴，b字段对应纵轴</li>
<li>tooltip 显示图标数据点的提示信息, 格式为<code>[&#39;a*b&#39;, (a,b)=&gt;({name:xx, value:yyy})]</code></li>
</ul>
<h4 id="Legend"><a href="#Legend" class="headerlink" title="Legend"></a>Legend</h4><p>图例。</p>
<ul>
<li>position 图例位置，默认为 ‘buttom-center’</li>
<li>layout 图例排列方式，vertical、horizontal</li>
<li>itemFormatter 图例文本展示</li>
</ul>
<h4 id="Tooltip"><a href="#Tooltip" class="headerlink" title="Tooltip"></a>Tooltip</h4><p>tooltip显示信息层</p>
<ul>
<li>triggerOn 触发形式，mousemove click none</li>
<li>crosshairs Object对象，tooltip辅助线样式，如{type:’line’, style:{}}</li>
</ul>
<h4 id="Slider"><a href="#Slider" class="headerlink" title="Slider"></a>Slider</h4><p>需要单独安装，<code>npm install bizcharts-plugin-slider</code>，作用与 ECharts <code>dataZoom</code> 类似，可以局部展示图表信息</p>
<h4 id="Dataset"><a href="#Dataset" class="headerlink" title="Dataset"></a>Dataset</h4><p>Dataset需要单独安装 <code>npm install @antv/data-set -save</code><br>Dataset Transform 包含很多数据转换，如sort, map, filter等静态处理，也有fold形变处理，还包括树hierarchy, 图diagram处理，可以利用 hierarchy 树形排列数据点，作用类似于包 <code>d3-hierarchy</code> 。</p>
<p>注意点Tips</p>
<ul>
<li>Geom中tooltip字段格式，’a<em>b</em>c’ 符号为 ‘ *</li>
<li>Geom中color可以为映射的字段名，也可以为颜色，如果颜色和字段名同名，将导致图表刷新切换，不稳定。</li>
<li>图表resize是监听的window resize事件，所以需要在区域联动变化时手动dispatch事件， window.dispatchEvent(new Event(‘resize’));  (<a href="https://github.com/alibaba/BizCharts/issues/75" target="_blank" rel="noopener">https://github.com/alibaba/BizCharts/issues/75</a>)</li>
<li>Bizcharts中没有Geom指定Y轴的接口，所以需要用DataView合并使用同一Y轴的数据  (<a href="https://github.com/alibaba/BizCharts/issues/591" target="_blank" rel="noopener">https://github.com/alibaba/BizCharts/issues/591</a>)</li>
<li>Y轴排序使用的js自动排序，所以 toFix 保留的字符串需要转化为数值。 (<a href="https://github.com/alibaba/BizCharts/issues/330" target="_blank" rel="noopener">https://github.com/alibaba/BizCharts/issues/330</a>)</li>
<li>Bizcharts提供的图表组件，可以在Chart内部使用自定义的组件或者html dom</li>
<li>Axis组件的横纵由Geom的position决定，跟组件顺序无关</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">import DataSet from &apos;@antv/data-set&apos;;</span><br><span class="line">// ...</span><br><span class="line">render() &#123; </span><br><span class="line">    const ds = new DataSet(); </span><br><span class="line">    const dv = ds.createView().source(this.bchart || []); </span><br><span class="line">    dv.transform(&#123;  // fold展开字段 </span><br><span class="line">        type: &apos;fold&apos;, </span><br><span class="line">        fields: [&apos;count4xx&apos;, &apos;count5xx&apos;], </span><br><span class="line">        key: &apos;count&apos;, </span><br><span class="line">        value: &apos;errCount&apos;, // value字段 </span><br><span class="line">    &#125;); </span><br><span class="line">    dv.transform(&#123; </span><br><span class="line">        type: &apos;fold&apos;, </span><br><span class="line">        fields: [&apos;count4xx_percent&apos;, &apos;count5xx_percent&apos;], </span><br><span class="line">        key: &apos;percent&apos;, </span><br><span class="line">        value: &apos;errPercent&apos;, // value字段 </span><br><span class="line">    &#125;); </span><br><span class="line">    return </span><br><span class="line">    ( </span><br><span class="line">        &lt;Chart </span><br><span class="line">          height=&#123;300&#125; </span><br><span class="line">          data=&#123;dv&#125; </span><br><span class="line">          forceFit </span><br><span class="line">          padding=&#123;[&apos;auto&apos;, 60, &apos;auto&apos;, &apos;auto&apos;]&#125; </span><br><span class="line">          scale=&#123;&#123; name: &#123; alias: &apos;时间&apos;, type: &apos;time&apos;, mask: &apos;YYYY-MM-DD HH:mm:ss&apos; &#125; &#125;&#125; //name存储时间戳，设置name字段的展示格式 </span><br><span class="line">          onPlotClick=&#123;this.errClick&#125; // 事件处理 </span><br><span class="line">          onTooltipChange=&#123;this.toolShow&#125; </span><br><span class="line">        &gt; </span><br><span class="line">          &lt;Axis name=&quot;name&quot; /&gt; </span><br><span class="line">          &lt;Axis name=&quot;errCount&quot; /&gt; // fold 展开的两个字段共用一个Y轴 </span><br><span class="line">          &lt;Axis name=&quot;errPercent&quot; label=&#123;&#123; formatter(percent) &#123; return `$&#123;(+percent * 100).toFixed(1)&#125; %`; &#125; &#125;&#125; /&gt; </span><br><span class="line">          &lt;Legend </span><br><span class="line">            position=&quot;top-center&quot; </span><br><span class="line">            itemFormatter=&#123;v =&gt; (&#123; // legend 文本格式 count4xx: &apos;4xx错误数&apos;,      count5xx: &apos;5xx错误数&apos;, count4xx_percent: &apos;4xx错误率&apos;,                count5xx_percent: &apos;5xx错误率&apos;, &#125;[v])&#125; </span><br><span class="line">          /&gt; </span><br><span class="line">          &lt;Tooltip crosshairs=&#123;&#123; type: &apos;line&apos;, &#125;&#125; /&gt; </span><br><span class="line">          &lt;Geom type=&quot;interval&quot; // interval可展示bar图 color=&quot;count&quot; // 颜色对应fold处理后的key:count </span><br><span class="line">            position=&quot;name*errCount&quot; </span><br><span class="line">            tooltip=&#123;[&apos;name*count*errCount&apos;, (name, count, val) =&gt; (&#123; name: &#123; count4xx: &apos;4xx错误数&apos;, count5xx: &apos;5xx错误数&apos; &#125;[count], value: val &#125;)]&#125; </span><br><span class="line">          /&gt; </span><br><span class="line">          &lt;Geom </span><br><span class="line">            type=&quot;line&quot; // line图 color=&quot;percent&quot; </span><br><span class="line">            position=&quot;name*errPercent&quot; // position确定横纵坐标轴展示的数据字段 tooltip=&#123;[&apos;name*percent*errPercent&apos;, (name, key, val) =&gt; (&#123; </span><br><span class="line">              name: &#123; count4xx_percent: &apos;4xx错误率&apos;, count5xx_percent: &apos;5xx错误率&apos; &#125;[key], </span><br><span class="line">              value: `$&#123;(val * 100).toFixed(2)&#125;%` &#125;)</span><br><span class="line">            ]&#125; </span><br><span class="line">          /&gt; </span><br><span class="line">          // 自定义组件，可以直接在Chart中，此处模仿实现，抓取错误趋势数据 </span><br><span class="line">          &lt;div //eslint-disable-line </span><br><span class="line">            onMouseLeave=&#123;() =&gt; &#123; this.setState(&#123; confirmShow: false, errList: null &#125;); &#125;&#125; </span><br><span class="line">            style=&#123;&#123; display: (this.state.confirmShow ? &apos;block&apos; : &apos;none&apos;) &#125;</span><br><span class="line">          &lt;div style=&#123;&#123; </span><br><span class="line">                position: &apos;absolute&apos;, </span><br><span class="line">                background: &apos;#fff&apos;, </span><br><span class="line">                border: &apos;1px solid #ccc&apos;, </span><br><span class="line">                width: 300, </span><br><span class="line">                height: 80, </span><br><span class="line">                zIndex: 2, </span><br><span class="line">                top: this.state.position ? this.state.position[1] + 20 : 0, left: this.state.position ? this.state.position[0] - 150 : 0, </span><br><span class="line">                &#125;&#125; </span><br><span class="line">          &gt; </span><br><span class="line">          &#123;!this.state.errList ? </span><br><span class="line">            &lt;div&gt; </span><br><span class="line">              &lt;h4&gt;是否确认获取错误数&lt;/h4&gt; </span><br><span class="line">              &lt;Button onClick=&#123;this.confirmList&#125;&gt;确认&lt;/Button&gt; </span><br><span class="line">              &lt;Button onClick=&#123;() =&gt; this.setState(&#123; confirmShow: false &#125;)&#125;&gt;取消&lt;/Button&gt; </span><br><span class="line">            &lt;/div&gt; </span><br><span class="line">            : </span><br><span class="line">            &lt;div&gt;&#123;this.state.errList&#125;&lt;/div&gt; &#125; &lt;/div&gt; </span><br><span class="line">          &lt;/div&gt; </span><br><span class="line">      &lt;/Chart&gt; </span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div></article></div></main><footer><div class="paginator"><a href="/2018/12/02/小程序探索/" class="prev">PREV</a><a href="/2018/09/16/关于ECharts-click事件的探索/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2018 <a href="http://yoursite.com">chendong</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>